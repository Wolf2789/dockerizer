#!/bin/bash
DOCKERIZER_PATH="$(cd -- $(dirname $0)/../ && pwd)"
if [ -f "$DOCKERIZER_PATH/config" ]; then
	. "$DOCKERIZER_PATH/config"
fi
NODE_VERSION=${NODE_VERSION:-$NODE_DEFAULT_VERSION}

execute() {
	docker run -it --rm \
		-e UID=$(id -u) \
		-e GID=$(id -g) \
		-w /workspace \
		-v "$PWD:/workspace" \
		"node:$NODE_VERSION" \
		$@
}

usage() {
	printf "\nUsage: $0 COMMAND"
	printf "\n\nValid COMMAND values:"
	printf "\n\tmodify\t\tOpen current script for modification in specified default editor (defined through \$DEFAULT_EDITOR variable [also located inside the script])"
	printf "\n\tdownload\tPerform 'docker pull' to download latest version of specified image"
	printf "\n\t*\t\tAnything that is valid for NodeJS command\n"
}

download() {
	docker pull "node:$NODE_VERSION"
}

case "$1" in
	help)     usage              ;;
	download) download           ;;
	modify)   $DEFAULT_EDITOR $0 ;;
	*)        execute "$@"  ;;
esac
